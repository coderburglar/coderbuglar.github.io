# DNS 域名系统（Domain Name System）

DNS 本质的作用就是将域名转换为 IP 地址。

看见上面的本质我们就会有一些小问题：

1. 我们为什么需要域名，IP 地址不能使用吗？
2. DNS 是如何转义的？
3. 我该怎么使用它？

## DNS 的必要性

> IP 地址可以用来表示主机和路由器的地址。

IP 地址大部分方面都很好，但是有几个很显著的问题：

- 1. IP 地址是一串数值。（比如 192.168.3.181:5137）
- 2. IP 地址因为是随机分配的，没有任何可以理解的意义。
- 3. 这相当于凭空少了一层保护层。（比如我去妹妹家，妹妹家的小区可以有一群碧桂园战神，单元门可以有刷卡才能打开的大门，家门需要密码打开，甚至都进了家门家里还有尊敬的岳父岳母），层数越多操作的可能性就越多。

## DNS 系统需要解决的问题（如何使用和维护以及如何转义）

- 1. 如何命名设备
- 2. 如何转义
- 3. 后期维护怎么做

经典环境，要想知道一个东西的时候不卡手，你就要了解它的背景（比如任何一门编程语言都不会平白无故地出现，它一定是想要或多或少地改变或更新原有的某一门语言。那它要改变的或者更新的往往就是这门语言的闪光点，你知道这门语言的闪光点，在面试的时候就可以像小学作文一样，无论写什么都往标题上面靠一样，无论面试官问什么你都在最后说一句所以这门语言 xxx）。

### DNS 的诞生背景

- ARPANET 的名字解析解决方案

  - 主机名：没有层次的一个字符串（一个平面，换句话说，我们以前看的谍战剧，都有上下线，并且有代号，上线可以联系下线，不能越级，也不能反过来联系，但是 ARPANET 是没有上下级大家都是一个 level）。
  - 存在着几个维护站：维护着一张主机名 - IP 地址的映射文件 HOSTS.txt
  - 每台主机定时从缓存站中拉取（还是相当于本地）

- ARPANET 解决的方案
  - 当网络中主机数量很大时 - 没有层级的主机名称很难分配 - 文件的管理、发布、查找都很麻烦。

总而言之，言而总之：就是管理的费劲了。（人们总是在偷懒中成长）

终于在 1983 年 DNS 被引入。

### DNS 的总体思路和目标

- DNS 的主要思路

  - 分层的、基于域的命名机制。（example.com） -> （.com） -> (.example) √
  - 若干分布式的数据库完成名字到 IP 的转换。（还是维护 IP 和域名，但是这次使用了分布式）
  - 运行在 UDP/TCP 之上的 53 端口的应用服务（我记着是 TCP 和 UDP 都有，反正你要是要的快点就用 UDP，不用握手ヽ(_^ｰ^)人(^ｰ^_)ノ，再见也不用挥手 ┏(＾ 0 ＾)┛）
  - 核心的 Internet 功能，但以应用层协议实现。（虽然核心，但是是在网络的边缘通过端系统的应用进程来实现，比如浏览器）

- DNS 的主要目的
  - 实现主机名-IP 地址的转换（name / IP translate）
  - 其他目的
    - 主机别名到规范名字的转换。（区分一个点，服务器名称不等于别名，你有一个服务器，服务器）
    - 邮件服务器别名到邮件服务器的正规名字。（比如你们学校提供了你们自己的电子邮箱@mit.edu 等等，当然这是 SMTP + DNS）
    - 负载均衡：Load Distribution（为了说明前两点，就不得不提负载均衡了，比如 xx 公司家大业大服务器数不胜数，但是哥们只用一个域名，四个服务器都能用，这就是负载均衡）

#### DNS 遇到的一些问题

##### DNS 命名空间（The DNS Name Space）

- DNS 域名结构

  - 一个层次命名设备会有很多重名。（还是谍战，比如你给自己的代号是张三，敲了隔壁也是张三，岂不是很麻烦。再加上你俩都在一个群里聊天大家一看不是懵了，哥们刚才联系的是哪个 zs 来的）
  - DNS 采用层次树结构的命名方式。（嗯，你得有上下级关系）
  - Internet 根被划分为几百个顶级域名。
    - 通用的，比如公司、组织、大学（术业有专攻）
    - 国家的（记住 .cn）
  - 每个子域下面可划分为若干子域
  - 树叶是主机（root）

- 域名的管理

  - 一个域名管理其子域（edu.cn）。
  - 创建一个新的域要挣得它所属的域的同意。

- 域与网络无关
  - 域遵守组织界限，而不是物理网络。
  - 域的划分是逻辑的，而不是物理的。

###### DNS 根名字服务器

一共有 13 个。（内部数据一样）

###### 解析

- 一个名字服务器的问题
  - 可靠性低：单点故障。
  - 扩展性问题：通信容量。
  - 维护问题：远距离的集中式数据库维护。
- 区域（Zone）
  - 区域的划分由区域管理者自己决定。
  - 将 DNS 名字空间划分为互不相交的区域，每个区域都是树的一部分。
  - 名字服务器（每个区域都有一个名字服务器，维护着他所管辖区域的权威信息）。
  - 名字服务器允许被放置在区域之外，以保障可靠性。

> 权威 DNS 服务器：组织结构的 DNS 服务器，提供组织结构服务器（web 和 mail）可访问主机和 IP 之间的映射（就是你有一个上线，上下知道你们下线全家老小的消息。(╬ಠ 益 ಠ)╯ つ ），组织机构可以选择实现自己维护或由某个服务提供商维护。

那就有一个问题了，它维护的到底是什么呢？

- 资源记录可以使用 `dig` 命令查看
  - domain_name：域名（如果 type 是 A 的情况）
  - ttl：存活周期（time to live），如果无限大就是权威记录。有限值两天可以有缓存。（缓存是为了性能，删除是为了确保一致性）
  - class：IN（Internet）
  - value：IP 地址（基本如果 type 是 A 的情况）
  - type：A, CNAME, NS, MX

##### DNS 大致工作过程

- 应用调用解析器（resolver）
- 解析器作为客户向 Name Server 发出查询报文（封装在 UDP 字段中）
- Name Server 返回响应报文

##### 本地名字服务器（Local Name Server）

- 并不属于层次结构
- 每个 ISP 都有一个本地的 DNS 服务器
- 当一个主机发起一个 DNS 查询时，查询被送到其本地 DNS 服务器

##### 名字服务器（Name Server）

- 名字解析过程
  - 目标名称在 Local Name Server 中
    - 情况一：查询的名字在该区域内部
    - 情况二：缓存

当与本地服务器不能解析名字时，联系根名字服务器顺着根-TLD 一直找到权威名字服务器。

递归查询

- 名字解析负担都放在当前联系的名字服务器上。
- 问题：根服务器负担太重。

解决方案：迭代查询。

> 什么你问为什么重很简单啊。大场景你要给五个哥们介绍对象，递归是什么呢，你每个都亲自陪着，等这个哥们配妹妹吃完饭、k完歌、city完walk,然后你再安排下一个，但是如果是迭代就不一样了，你找五个哥们叫过来让他们分别去找妹妹，然后回来挨个训话问谁是小丑谁是 king。


